<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resumen Gerencial VOX</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; padding: 20px; max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; color: #2c3e50; }
        
        .search-box {
            background: white; padding: 20px; border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            display: flex; justify-content: center; gap: 15px; margin-bottom: 30px;
        }
        input[type="date"] { padding: 10px; font-size: 1.1rem; border-radius: 6px; border: 1px solid #ccc; }
        button { padding: 10px 25px; background: #2980b9; color: white; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; }
        button:hover { background: #3498db; }

        /* Contenedor de Tarjetas */
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        
        .card {
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); position: relative; overflow: hidden;
            border-top: 5px solid #ccc;
        }
        
        /* Colores por Turno */
        .card.Ma√±ana { border-top-color: #f1c40f; } /* Amarillo */
        .card.Tarde { border-top-color: #e67e22; }  /* Naranja */
        .card.Noche { border-top-color: #2c3e50; }  /* Azul Oscuro */

        .card h2 { margin-top: 0; font-size: 1.4rem; color: #555; display: flex; justify-content: space-between; }
        .card .icono { font-size: 1.5rem; }
        
        .monto-grande { font-size: 2rem; font-weight: bold; color: #27ae60; margin: 15px 0; }
        
        .info-extra { background: #f8f9fa; padding: 10px; border-radius: 6px; font-size: 0.9rem; color: #666; }
        .info-extra div { margin-bottom: 5px; }
        .etiqueta { font-weight: bold; color: #888; }

    </style>
</head>
<body>

    <h1>üìä Reporte Diario Unificado</h1>

    <div class="search-box">
        <input type="date" id="fechaSelector">
        <button onclick="cargarResumen()">Ver Reporte</button>
    </div>

    <div id="dashboard" class="dashboard">
        <div style="grid-column: 1/-1; text-align: center; color:#888">Selecciona una fecha para ver el resumen.</div>
    </div>

    <script>
        const formatMoney = (val) => new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS' }).format(val);

        const iconos = {
            "Ma√±ana": "üåÖ",
            "Tarde": "‚òÄÔ∏è",
            "Noche": "üåô"
        };

        async function cargarResumen() {
            const fecha = document.getElementById('fechaSelector').value;
            const dashboard = document.getElementById('dashboard');
            
            if(!fecha) return alert("Selecciona una fecha");

            dashboard.innerHTML = '<p style="text-align:center; width:100%">Calculando agrupaci√≥n...</p>';

            try {
                const res = await fetch(`/api/resumen-dia/${fecha}`);
                const datos = await res.json();
                
                dashboard.innerHTML = ''; // Limpiar

                let totalDia = 0;

                datos.forEach(turno => {
                    totalDia += turno.monto;
                    
                    const card = document.createElement('div');
                    card.className = `card ${turno.turno}`;
                    card.innerHTML = `
                        <h2>
                            ${turno.turno}
                            <span class="icono">${iconos[turno.turno]}</span>
                        </h2>
                        <div class="monto-grande">${formatMoney(turno.monto)}</div>
                        
                        <div class="info-extra">
                            <div><span class="etiqueta">Horario Real:</span> <br>${turno.horario}</div>
                            <div><span class="etiqueta">Cierres Agrupados:</span> ${turno.cantidad_cierres}</div>
                        </div>
                    `;
                    dashboard.appendChild(card);
                });

                // Tarjeta de Total del D√≠a
                const cardTotal = document.createElement('div');
                cardTotal.className = 'card';
                cardTotal.style.borderTopColor = '#27ae60';
                cardTotal.innerHTML = `
                    <h2>TOTAL D√çA üí∞</h2>
                    <div class="monto-grande" style="color:#27ae60">${formatMoney(totalDia)}</div>
                    <div class="info-extra">Suma de los 3 turnos</div>
                `;
                dashboard.appendChild(cardTotal);

            } catch (e) {
                console.error(e);
                dashboard.innerHTML = '<p style="color:red; text-align:center">Error al conectar con el servidor.</p>';
            }
        }
        
        // Auto-seleccionar hoy
        document.getElementById('fechaSelector').valueAsDate = new Date();
    </script>

</body>
</html>
